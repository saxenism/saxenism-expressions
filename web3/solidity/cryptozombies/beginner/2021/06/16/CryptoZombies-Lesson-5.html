<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>CryptoZombies - Lesson 5 | EVM Expressions</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="CryptoZombies - Lesson 5" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="My notes from lesson 5 of CryptoZombies Solidity speed run." />
<meta property="og:description" content="My notes from lesson 5 of CryptoZombies Solidity speed run." />
<link rel="canonical" href="http://github.saxenism.io/saxenism-expressions/web3/solidity/cryptozombies/beginner/2021/06/16/CryptoZombies-Lesson-5.html" />
<meta property="og:url" content="http://github.saxenism.io/saxenism-expressions/web3/solidity/cryptozombies/beginner/2021/06/16/CryptoZombies-Lesson-5.html" />
<meta property="og:site_name" content="EVM Expressions" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-16T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CryptoZombies - Lesson 5" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-06-16T00:00:00-05:00","datePublished":"2021-06-16T00:00:00-05:00","description":"My notes from lesson 5 of CryptoZombies Solidity speed run.","headline":"CryptoZombies - Lesson 5","mainEntityOfPage":{"@type":"WebPage","@id":"http://github.saxenism.io/saxenism-expressions/web3/solidity/cryptozombies/beginner/2021/06/16/CryptoZombies-Lesson-5.html"},"url":"http://github.saxenism.io/saxenism-expressions/web3/solidity/cryptozombies/beginner/2021/06/16/CryptoZombies-Lesson-5.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/saxenism-expressions/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://github.saxenism.io/saxenism-expressions/feed.xml" title="EVM Expressions" /><link rel="shortcut icon" type="image/x-icon" href="/saxenism-expressions/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/saxenism-expressions/">EVM Expressions</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/saxenism-expressions/about/">About Me</a><a class="page-link" href="/saxenism-expressions/search/">Search</a><a class="page-link" href="/saxenism-expressions/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">CryptoZombies - Lesson 5</h1><p class="page-description">My notes from lesson 5 of CryptoZombies Solidity speed run.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-06-16T00:00:00-05:00" itemprop="datePublished">
        Jun 16, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      8 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/saxenism-expressions/categories/#web3">web3</a>
        &nbsp;
      
        <a class="category-tags-link" href="/saxenism-expressions/categories/#solidity">solidity</a>
        &nbsp;
      
        <a class="category-tags-link" href="/saxenism-expressions/categories/#cryptozombies">cryptozombies</a>
        &nbsp;
      
        <a class="category-tags-link" href="/saxenism-expressions/categories/#beginner">beginner</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#lesson-5">Lesson 5:</a>
<ul>
<li class="toc-entry toc-h4"><a href="#also-thanks-for-loom-network-for-bringing-such-awesome-animations-to-us-d">Also, thanks for Loom Network for bringing such awesome animations to us :D</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#solidity-code-from-lesson-5">Solidity code from Lesson 5:</a>
<ul>
<li class="toc-entry toc-h2"><a href="#erc721sol">erc721.sol</a></li>
<li class="toc-entry toc-h2"><a href="#safemathsol">safemath.sol</a></li>
<li class="toc-entry toc-h2"><a href="#zombieownershipsol">zombieownership.sol</a></li>
<li class="toc-entry toc-h2"><a href="#zombieattacksol">zombieattack.sol</a></li>
<li class="toc-entry toc-h2"><a href="#zombiefactorysol">zombiefactory.sol</a></li>
<li class="toc-entry toc-h2"><a href="#zombiefeedingsol">zombiefeeding.sol</a></li>
<li class="toc-entry toc-h2"><a href="#zombiehelpersol">zombiehelper.sol</a></li>
</ul>
</li>
</ul><h1 id="lesson-5">
<a class="anchor" href="#lesson-5" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://share.cryptozombies.io/en/lesson/5/share/H4XF13LD_MORRIS_%F0%9F%92%AF%F0%9F%92%AF%F0%9F%98%8E%F0%9F%92%AF%F0%9F%92%AF">Lesson 5</a>:</h1>

<ol>
  <li>
    <p>Tokens on Ethereum:
 A token on Ethereum is basically just a smart contract that follows some common rules — namely it implements
 a standard set of functions that all other token contracts share.
 The token standard that’s a much better fit for crypto-collectibles like CryptoZombies — is called ERC721 tokens.
 ERC721 tokens are not interchangeable since each one is assumed to be unique, and are not divisible. You can 
 only trade them in whole units, and each one has a unique ID. 
 using a standard like ERC721 has the benefit that we don’t have to implement the auction or escrow logic within our 
 contract that determines how players can trade / sell our zombies. If we conform to the spec, someone else could build
 an exchange platform for crypto-tradable ERC721 assets, and our ERC721 zombies would be usable on that platform. So there
 are clear benefits to using a token standard instead of rolling your own trading logic.</p>
  </li>
  <li>The contract of ERC721 standard looks pretty much like an interface, waiting to be implemented:
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> contract ERC721 {
 event Transfer(address indexed _from, address indexed _to, uint256 indexed _tokenId);
 event Approval(address indexed _owner, address indexed _approved, uint256 indexed _tokenId);
 function balanceOf(address _owner) external view returns (uint256);
 function ownerOf(uint256 _tokenId) external view returns (address);
 function transferFrom(address _from, address _to, uint256 _tokenId) external payable;
 function approve(address _approved, uint256 _tokenId) external payable;
 }
</code></pre></div>    </div>
  </li>
  <li>
    <p>In Solidity, we can inheirt from multiple contracts.</p>
  </li>
  <li>To avoid overflows and underflows, we use the SafeMath library. A library is a special type of contract in Solidity. 
One of the things it is useful for is to attach functions to native data types.
For example, with the SafeMath library, we’ll use the syntax using SafeMath for uint256. The SafeMath library has 4 functions
 — add, sub, mul, and div. And now we can access these functions from uint256 as follows:
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> using SafeMath for uint256;
 uint256 a = 5;
 uint256 b = a.add(3); // 5 + 3 = 8
 uint256 c = a.mul(2); // 5 * 2 = 10
</code></pre></div>    </div>
  </li>
  <li>
    <p>assert is similar to require, where it will throw an error if false. The difference between assert and require is that 
require will refund the user the rest of their gas when a function fails, whereas assert will not. So most of the time you 
want to use require in your code; assert is typically used when something has gone horribly wrong with the code (like a uint overflow).</p>
  </li>
  <li>The standard in the Solidity community is to use a format called natspec.</li>
</ol>

<h4 id="also-thanks-for-loom-network-for-bringing-such-awesome-animations-to-us-d">
<a class="anchor" href="#also-thanks-for-loom-network-for-bringing-such-awesome-animations-to-us-d" aria-hidden="true"><span class="octicon octicon-link"></span></a>Also, thanks for <a href="https://loomx.io/">Loom Network</a> for bringing such awesome animations to us :D</h4>

<p><br>
<br></p>

<h1 id="solidity-code-from-lesson-5">
<a class="anchor" href="#solidity-code-from-lesson-5" aria-hidden="true"><span class="octicon octicon-link"></span></a>Solidity code from Lesson 5:</h1>

<h2 id="erc721sol">
<a class="anchor" href="#erc721sol" aria-hidden="true"><span class="octicon octicon-link"></span></a>erc721.sol</h2>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">ERC721</span> <span class="p">{</span>
  <span class="k">event</span> <span class="n">Transfer</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">_tokenId</span><span class="p">);</span>
  <span class="k">event</span> <span class="n">Approval</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">_owner</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">_approved</span><span class="p">,</span> <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">_tokenId</span><span class="p">);</span>

  <span class="k">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>
  <span class="k">function</span> <span class="n">ownerOf</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
  <span class="k">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">payable</span><span class="p">;</span>
  <span class="k">function</span> <span class="n">approve</span><span class="p">(</span><span class="kt">address</span> <span class="n">_approved</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">payable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="safemathsol">
<a class="anchor" href="#safemathsol" aria-hidden="true"><span class="octicon octicon-link"></span></a>safemath.sol</h2>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="cm">/**
 * @title SafeMath
 * @dev Math operations with safety checks that throw on error
 */</span>
<span class="k">library</span> <span class="n">SafeMath</span> <span class="p">{</span>

  <span class="cm">/**
  * @dev Multiplies two numbers, throws on overflow.
  */</span>
  <span class="k">function</span> <span class="n">mul</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">uint256</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
    <span class="nb">assert</span><span class="p">(</span><span class="n">c</span> <span class="o">/</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**
  * @dev Integer division of two numbers, truncating the quotient.
  */</span>
  <span class="k">function</span> <span class="n">div</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// assert(b &gt; 0); // Solidity automatically throws when dividing by 0
</span>    <span class="kt">uint256</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">;</span>
    <span class="c1">// assert(a == b * c + a % b); // There is no case in which this doesn't hold
</span>    <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**
  * @dev Subtracts two numbers, throws on overflow (i.e. if subtrahend is greater than minuend).
  */</span>
  <span class="k">function</span> <span class="n">sub</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">assert</span><span class="p">(</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**
  * @dev Adds two numbers, throws on overflow.
  */</span>
  <span class="k">function</span> <span class="n">add</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
    <span class="nb">assert</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**
 * @title SafeMath32
 * @dev SafeMath library implemented for uint32
 */</span>
<span class="k">library</span> <span class="n">SafeMath32</span> <span class="p">{</span>

  <span class="k">function</span> <span class="n">mul</span><span class="p">(</span><span class="kt">uint32</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint32</span> <span class="n">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint32</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">uint32</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
    <span class="nb">assert</span><span class="p">(</span><span class="n">c</span> <span class="o">/</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">div</span><span class="p">(</span><span class="kt">uint32</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint32</span> <span class="n">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint32</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// assert(b &gt; 0); // Solidity automatically throws when dividing by 0
</span>    <span class="kt">uint32</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">;</span>
    <span class="c1">// assert(a == b * c + a % b); // There is no case in which this doesn't hold
</span>    <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">sub</span><span class="p">(</span><span class="kt">uint32</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint32</span> <span class="n">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint32</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">assert</span><span class="p">(</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">add</span><span class="p">(</span><span class="kt">uint32</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint32</span> <span class="n">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint32</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint32</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
    <span class="nb">assert</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**
 * @title SafeMath16
 * @dev SafeMath library implemented for uint16
 */</span>
<span class="k">library</span> <span class="n">SafeMath16</span> <span class="p">{</span>

  <span class="k">function</span> <span class="n">mul</span><span class="p">(</span><span class="kt">uint16</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint16</span> <span class="n">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint16</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">uint16</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
    <span class="nb">assert</span><span class="p">(</span><span class="n">c</span> <span class="o">/</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">div</span><span class="p">(</span><span class="kt">uint16</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint16</span> <span class="n">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint16</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// assert(b &gt; 0); // Solidity automatically throws when dividing by 0
</span>    <span class="kt">uint16</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">;</span>
    <span class="c1">// assert(a == b * c + a % b); // There is no case in which this doesn't hold
</span>    <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">sub</span><span class="p">(</span><span class="kt">uint16</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint16</span> <span class="n">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint16</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">assert</span><span class="p">(</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">add</span><span class="p">(</span><span class="kt">uint16</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint16</span> <span class="n">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint16</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint16</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
    <span class="nb">assert</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="zombieownershipsol">
<a class="anchor" href="#zombieownershipsol" aria-hidden="true"><span class="octicon octicon-link"></span></a>zombieownership.sol</h2>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"./zombieattack.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"./erc721.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"./safemath.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">ZombieOwnership</span> <span class="k">is</span> <span class="n">ZombieAttack</span><span class="p">,</span> <span class="n">ERC721</span> <span class="p">{</span>

  <span class="k">using</span> <span class="n">SafeMath</span> <span class="k">for</span> <span class="kt">uint256</span><span class="p">;</span>

  <span class="k">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">address</span><span class="p">)</span> <span class="n">zombieApprovals</span><span class="p">;</span>

  <span class="k">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">ownerZombieCount</span><span class="p">[</span><span class="n">_owner</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">ownerOf</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">zombieToOwner</span><span class="p">[</span><span class="n">_tokenId</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">_transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="k">private</span> <span class="p">{</span>
    <span class="n">ownerZombieCount</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">=</span> <span class="n">ownerZombieCount</span><span class="p">[</span><span class="n">_to</span><span class="p">].</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">ownerZombieCount</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">ownerZombieCount</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">].</span><span class="n">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">zombieToOwner</span><span class="p">[</span><span class="n">_tokenId</span><span class="p">]</span> <span class="o">=</span> <span class="n">_to</span><span class="p">;</span>
    <span class="k">emit</span> <span class="n">Transfer</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_tokenId</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span>
      <span class="nb">require</span> <span class="p">(</span><span class="n">zombieToOwner</span><span class="p">[</span><span class="n">_tokenId</span><span class="p">]</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">||</span> <span class="n">zombieApprovals</span><span class="p">[</span><span class="n">_tokenId</span><span class="p">]</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>
      <span class="n">_transfer</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_tokenId</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="k">function</span> <span class="n">approve</span><span class="p">(</span><span class="kt">address</span> <span class="n">_approved</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">payable</span> <span class="n">onlyOwnerOf</span><span class="p">(</span><span class="n">_tokenId</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">zombieApprovals</span><span class="p">[</span><span class="n">_tokenId</span><span class="p">]</span> <span class="o">=</span> <span class="n">_approved</span><span class="p">;</span>
      <span class="k">emit</span> <span class="n">Approval</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">_approved</span><span class="p">,</span> <span class="n">_tokenId</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>
<h2 id="zombieattacksol">
<a class="anchor" href="#zombieattacksol" aria-hidden="true"><span class="octicon octicon-link"></span></a>zombieattack.sol</h2>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"./zombiehelper.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">ZombieAttack</span> <span class="k">is</span> <span class="n">ZombieHelper</span> <span class="p">{</span>
  <span class="kt">uint</span> <span class="n">randNonce</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">uint</span> <span class="n">attackVictoryProbability</span> <span class="o">=</span> <span class="mi">70</span><span class="p">;</span>

  <span class="k">function</span> <span class="n">randMod</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_modulus</span><span class="p">)</span> <span class="k">internal</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">randNonce</span> <span class="o">=</span> <span class="n">randNonce</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="kt">uint</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="n">abi</span><span class="p">.</span><span class="n">encodePacked</span><span class="p">(</span><span class="nb">now</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">randNonce</span><span class="p">)))</span> <span class="o">%</span> <span class="n">_modulus</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">attack</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_zombieId</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_targetId</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyOwnerOf</span><span class="p">(</span><span class="n">_zombieId</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Zombie</span> <span class="k">storage</span> <span class="n">myZombie</span> <span class="o">=</span> <span class="n">zombies</span><span class="p">[</span><span class="n">_zombieId</span><span class="p">];</span>
    <span class="n">Zombie</span> <span class="k">storage</span> <span class="n">enemyZombie</span> <span class="o">=</span> <span class="n">zombies</span><span class="p">[</span><span class="n">_targetId</span><span class="p">];</span>
    <span class="kt">uint</span> <span class="n">rand</span> <span class="o">=</span> <span class="n">randMod</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rand</span> <span class="o">&lt;=</span> <span class="n">attackVictoryProbability</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">myZombie</span><span class="p">.</span><span class="n">winCount</span> <span class="o">=</span> <span class="n">myZombie</span><span class="p">.</span><span class="n">winCount</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">myZombie</span><span class="p">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">myZombie</span><span class="p">.</span><span class="n">level</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">enemyZombie</span><span class="p">.</span><span class="n">lossCount</span> <span class="o">=</span> <span class="n">enemyZombie</span><span class="p">.</span><span class="n">lossCount</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">feedAndMultiply</span><span class="p">(</span><span class="n">_zombieId</span><span class="p">,</span> <span class="n">enemyZombie</span><span class="p">.</span><span class="n">dna</span><span class="p">,</span> <span class="s">"zombie"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">myZombie</span><span class="p">.</span><span class="n">lossCount</span> <span class="o">=</span> <span class="n">myZombie</span><span class="p">.</span><span class="n">lossCount</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">enemyZombie</span><span class="p">.</span><span class="n">winCount</span> <span class="o">=</span> <span class="n">enemyZombie</span><span class="p">.</span><span class="n">winCount</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">_triggerCooldown</span><span class="p">(</span><span class="n">myZombie</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="zombiefactorysol">
<a class="anchor" href="#zombiefactorysol" aria-hidden="true"><span class="octicon octicon-link"></span></a>zombiefactory.sol</h2>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"./ownable.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"./safemath.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">ZombieFactory</span> <span class="k">is</span> <span class="n">Ownable</span> <span class="p">{</span>

  <span class="k">using</span> <span class="n">SafeMath</span> <span class="k">for</span> <span class="kt">uint256</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">SafeMath32</span> <span class="k">for</span> <span class="kt">uint32</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">SafeMath16</span> <span class="k">for</span> <span class="kt">uint16</span><span class="p">;</span>

  <span class="k">event</span> <span class="n">NewZombie</span><span class="p">(</span><span class="kt">uint</span> <span class="n">zombieId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">dna</span><span class="p">);</span>

  <span class="kt">uint</span> <span class="n">dnaDigits</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
  <span class="kt">uint</span> <span class="n">dnaModulus</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">dnaDigits</span><span class="p">;</span>
  <span class="kt">uint</span> <span class="n">cooldownTime</span> <span class="o">=</span> <span class="mi">1</span> <span class="kc">days</span><span class="p">;</span>

  <span class="k">struct</span> <span class="n">Zombie</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">dna</span><span class="p">;</span>
    <span class="kt">uint32</span> <span class="n">level</span><span class="p">;</span>
    <span class="kt">uint32</span> <span class="n">readyTime</span><span class="p">;</span>
    <span class="kt">uint16</span> <span class="n">winCount</span><span class="p">;</span>
    <span class="kt">uint16</span> <span class="n">lossCount</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">Zombie</span><span class="p">[]</span> <span class="k">public</span> <span class="n">zombies</span><span class="p">;</span>

  <span class="k">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">address</span><span class="p">)</span> <span class="k">public</span> <span class="n">zombieToOwner</span><span class="p">;</span>
  <span class="k">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">ownerZombieCount</span><span class="p">;</span>

  <span class="k">function</span> <span class="n">_createZombie</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">_name</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_dna</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">id</span> <span class="o">=</span> <span class="n">zombies</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Zombie</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">_dna</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kt">uint32</span><span class="p">(</span><span class="nb">now</span> <span class="o">+</span> <span class="n">cooldownTime</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">zombieToOwner</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
    <span class="n">ownerZombieCount</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">ownerZombieCount</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">].</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">emit</span> <span class="n">NewZombie</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">_name</span><span class="p">,</span> <span class="n">_dna</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">_generateRandomDna</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">_str</span><span class="p">)</span> <span class="k">private</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">rand</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="n">abi</span><span class="p">.</span><span class="n">encodePacked</span><span class="p">(</span><span class="n">_str</span><span class="p">)));</span>
    <span class="k">return</span> <span class="n">rand</span> <span class="o">%</span> <span class="n">dnaModulus</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">createRandomZombie</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">_name</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">ownerZombieCount</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">uint</span> <span class="n">randDna</span> <span class="o">=</span> <span class="n">_generateRandomDna</span><span class="p">(</span><span class="n">_name</span><span class="p">);</span>
    <span class="n">randDna</span> <span class="o">=</span> <span class="n">randDna</span> <span class="o">-</span> <span class="n">randDna</span> <span class="o">%</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">_createZombie</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">randDna</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<h2 id="zombiefeedingsol">
<a class="anchor" href="#zombiefeedingsol" aria-hidden="true"><span class="octicon octicon-link"></span></a>zombiefeeding.sol</h2>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"./zombiefactory.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">KittyInterface</span> <span class="p">{</span>
  <span class="k">function</span> <span class="n">getKitty</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_id</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span>
    <span class="kt">bool</span> <span class="n">isGestating</span><span class="p">,</span>
    <span class="kt">bool</span> <span class="n">isReady</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">cooldownIndex</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">nextActionAt</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">siringWithId</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">birthTime</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">matronId</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">sireId</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">generation</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">genes</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">ZombieFeeding</span> <span class="k">is</span> <span class="n">ZombieFactory</span> <span class="p">{</span>

  <span class="n">KittyInterface</span> <span class="n">kittyContract</span><span class="p">;</span>

  <span class="k">modifier</span> <span class="n">onlyOwnerOf</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_zombieId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">zombieToOwner</span><span class="p">[</span><span class="n">_zombieId</span><span class="p">]);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">setKittyContractAddress</span><span class="p">(</span><span class="kt">address</span> <span class="n">_address</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
    <span class="n">kittyContract</span> <span class="o">=</span> <span class="n">KittyInterface</span><span class="p">(</span><span class="n">_address</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">_triggerCooldown</span><span class="p">(</span><span class="n">Zombie</span> <span class="k">storage</span> <span class="n">_zombie</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
    <span class="n">_zombie</span><span class="p">.</span><span class="n">readyTime</span> <span class="o">=</span> <span class="kt">uint32</span><span class="p">(</span><span class="nb">now</span> <span class="o">+</span> <span class="n">cooldownTime</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">_isReady</span><span class="p">(</span><span class="n">Zombie</span> <span class="k">storage</span> <span class="n">_zombie</span><span class="p">)</span> <span class="k">internal</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">_zombie</span><span class="p">.</span><span class="n">readyTime</span> <span class="o">&lt;=</span> <span class="nb">now</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">feedAndMultiply</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_zombieId</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_targetDna</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">_species</span><span class="p">)</span> <span class="k">internal</span> <span class="n">onlyOwnerOf</span><span class="p">(</span><span class="n">_zombieId</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Zombie</span> <span class="k">storage</span> <span class="n">myZombie</span> <span class="o">=</span> <span class="n">zombies</span><span class="p">[</span><span class="n">_zombieId</span><span class="p">];</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">_isReady</span><span class="p">(</span><span class="n">myZombie</span><span class="p">));</span>
    <span class="n">_targetDna</span> <span class="o">=</span> <span class="n">_targetDna</span> <span class="o">%</span> <span class="n">dnaModulus</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">newDna</span> <span class="o">=</span> <span class="p">(</span><span class="n">myZombie</span><span class="p">.</span><span class="n">dna</span> <span class="o">+</span> <span class="n">_targetDna</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="n">abi</span><span class="p">.</span><span class="n">encodePacked</span><span class="p">(</span><span class="n">_species</span><span class="p">))</span> <span class="o">==</span> <span class="nb">keccak256</span><span class="p">(</span><span class="n">abi</span><span class="p">.</span><span class="n">encodePacked</span><span class="p">(</span><span class="s">"kitty"</span><span class="p">)))</span> <span class="p">{</span>
      <span class="n">newDna</span> <span class="o">=</span> <span class="n">newDna</span> <span class="o">-</span> <span class="n">newDna</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">99</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">_createZombie</span><span class="p">(</span><span class="s">"NoName"</span><span class="p">,</span> <span class="n">newDna</span><span class="p">);</span>
    <span class="n">_triggerCooldown</span><span class="p">(</span><span class="n">myZombie</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">feedOnKitty</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_zombieId</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_kittyId</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">kittyDna</span><span class="p">;</span>
    <span class="p">(,,,,,,,,,</span><span class="n">kittyDna</span><span class="p">)</span> <span class="o">=</span> <span class="n">kittyContract</span><span class="p">.</span><span class="n">getKitty</span><span class="p">(</span><span class="n">_kittyId</span><span class="p">);</span>
    <span class="n">feedAndMultiply</span><span class="p">(</span><span class="n">_zombieId</span><span class="p">,</span> <span class="n">kittyDna</span><span class="p">,</span> <span class="s">"kitty"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="zombiehelpersol">
<a class="anchor" href="#zombiehelpersol" aria-hidden="true"><span class="octicon octicon-link"></span></a>zombiehelper.sol</h2>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"./zombiefeeding.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">ZombieHelper</span> <span class="k">is</span> <span class="n">ZombieFeeding</span> <span class="p">{</span>

  <span class="kt">uint</span> <span class="n">levelUpFee</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="kc">ether</span><span class="p">;</span>

  <span class="k">modifier</span> <span class="n">aboveLevel</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_level</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_zombieId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">zombies</span><span class="p">[</span><span class="n">_zombieId</span><span class="p">].</span><span class="n">level</span> <span class="o">&gt;=</span> <span class="n">_level</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="k">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">_owner</span> <span class="o">=</span> <span class="n">owner</span><span class="p">();</span>
    <span class="n">_owner</span><span class="p">.</span><span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">setLevelUpFee</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_fee</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
    <span class="n">levelUpFee</span> <span class="o">=</span> <span class="n">_fee</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">levelUp</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_zombieId</span><span class="p">)</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">levelUpFee</span><span class="p">);</span>
    <span class="n">zombies</span><span class="p">[</span><span class="n">_zombieId</span><span class="p">].</span><span class="n">level</span> <span class="o">=</span> <span class="n">zombies</span><span class="p">[</span><span class="n">_zombieId</span><span class="p">].</span><span class="n">level</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">changeName</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_zombieId</span><span class="p">,</span> <span class="kt">string</span> <span class="k">calldata</span> <span class="n">_newName</span><span class="p">)</span> <span class="k">external</span> <span class="n">aboveLevel</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">_zombieId</span><span class="p">)</span> <span class="n">onlyOwnerOf</span><span class="p">(</span><span class="n">_zombieId</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">zombies</span><span class="p">[</span><span class="n">_zombieId</span><span class="p">].</span><span class="n">name</span> <span class="o">=</span> <span class="n">_newName</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">changeDna</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_zombieId</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_newDna</span><span class="p">)</span> <span class="k">external</span> <span class="n">aboveLevel</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">_zombieId</span><span class="p">)</span> <span class="n">onlyOwnerOf</span><span class="p">(</span><span class="n">_zombieId</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">zombies</span><span class="p">[</span><span class="n">_zombieId</span><span class="p">].</span><span class="n">dna</span> <span class="o">=</span> <span class="n">_newDna</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">getZombiesByOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="n">ownerZombieCount</span><span class="p">[</span><span class="n">_owner</span><span class="p">]);</span>
    <span class="kt">uint</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">zombies</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">zombieToOwner</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">_owner</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">result</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">counter</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>


  </div><a class="u-url" href="/saxenism-expressions/web3/solidity/cryptozombies/beginner/2021/06/16/CryptoZombies-Lesson-5.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/saxenism-expressions/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/saxenism-expressions/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/saxenism-expressions/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Personal website of Rahul Saxena, aka saxenism, containing his thoughts about web3, EVM and a decentralised world.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/saxenism" target="_blank" title="saxenism"><svg class="svg-icon grey"><use xlink:href="/saxenism-expressions/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/saxenism" target="_blank" title="saxenism"><svg class="svg-icon grey"><use xlink:href="/saxenism-expressions/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
